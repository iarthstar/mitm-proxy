<html>

<head>

</head>

<body>
  <div id="root"></div>
  <script>
    const applyStylesForID = (id, styles) => {
      Object.keys(styles).forEach((key) => {
        window[id].style[key] = styles[key];
      });
    };

    const applyStylesToElement = (elem, styles) => {
      Object.keys(styles).forEach((key) => {
        elem.style[key] = styles[key];
      });
    };

    const updateChild = async (elem, data, elemIndex, i) => {
      let number = elemIndex + i;
      elem.innerHTML = ((number++ % 256).toString(16) + " ").toUpperCase().repeat(10);
    }

    const rootHeight = 500;

    const rootStyle = {
      height: rootHeight + "px",
      width: "100%",
      border: "4px solid red",
      overflow: "scroll"
    };

    const testAsync = async (elem, data, elemIndex, i) => {
      const startTime = performance.now();
      // await new Promise((resolve => {
      //   setTimeout(() => {
      //     console.log("IN ASYNC", i);
      //     resolve();
      //   }, 2000);
      // }));
      await updateChild(elem, children[elemIndex + i], elemIndex, i);
      const endTime = performance.now();
      console.log("OP Time", endTime - startTime);
    };

    applyStylesForID("root", rootStyle);

    const children = [1, 2, 3, 4, 5, 6, 7, 8, 9]
      .map(e => [1, 2, 3, 4, 5, 6, 7, 8, 9]).flat()
      // .map(e => [1,2,3,4,5,6,7,8,9]).flat()
      .map(e => [1, 2, 3, 4, 5, 6, 7, 8, 9]).flat();

    const cellStyle = {
      width: "100%",
      height: "20px",
      fontFamily: "Source Code Pro"
    };

    let scrollPositionY = 0;
    let scrollOffset = 20;
    let itemHeight = 20;
    let totalHeight = itemHeight * children.length;

    const visibleChildrenLength = rootHeight / itemHeight;

    children.slice(0, visibleChildrenLength).map((e, i) => {
      const div = document.createElement("div");
      applyStylesToElement(div, cellStyle);
      let number = i;
      div.innerHTML = ((number++).toString(16) + " ").toUpperCase().repeat(10);
      // div.style.background = "#" + ("0".repeat(6 - String(i * 10).length) + i * 10);

      window.root.appendChild(div);
    });

    window.root.addEventListener('wheel', (e) => {
      e.preventDefault();
      // console.log("Wheel", e);


      // console.log("Index", scrollPositionY / scrollOffset);
      const elemIndex = scrollPositionY / scrollOffset;

      if (elemIndex + visibleChildrenLength >= children.length && e.deltaY > 0) {
        // console.log("ENDED");
        return;
      } else {
        if (e.deltaY < 0 && scrollPositionY >= itemHeight) {
          scrollPositionY -= scrollOffset;
          // root.scrollTo(0,scrollPositionY);
        } else if (e.deltaY > 0 && scrollPositionY <= totalHeight) {
          scrollPositionY += scrollOffset;
          // root.scrollTo(0,scrollPositionY);
        }
        // console.log("Not ENDED");

        const len = window.root.children.length;

        // for (let i = 0; i < len; i++) {
        //   testAsync([...window.root.children][i], children[elemIndex + i], elemIndex, i);
        //   console.log("IN FOR", i);
        // }

        [...window.root.children].map((elem, i) => {
          ;
          updateChild(elem, children[elemIndex + i], elemIndex, i);
          // elem.style.background = "#" + ("0".repeat(6 - String((elemIndex + i) * 10).length) + (elemIndex + i) * 10);
        });

        // children.slice(elemIndex, elemIndex + visibleChildrenLength).map((e, i) => {
        //   const div = document.createElement("div");
        //   applyStylesToElement(div, cellStyle);


        //   window.root.appendChild(div);
        // });
      }
    });
  </script>
</body>

</html>